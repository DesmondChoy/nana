{"id":"nana-0no","title":"Browser refresh (Ctrl-R) doesn't trigger navigation warning in Chrome","description":"## Problem\nWhen on the StudyPage with an active PDF session in Google Chrome:\n- ✅ Clicking 'Upload New PDF' → Shows confirmation modal\n- ✅ Browser back button → Shows confirmation modal  \n- ❌ Ctrl-R (page refresh) → Exits immediately without warning\n\n## Environment\n- Browser: Google Chrome\n- OS: macOS\n\n## Implementation Attempts (Did Not Work)\n\n### Attempt 1: Empty returnValue\n```typescript\nconst handleBeforeUnload = (e: BeforeUnloadEvent) =\u003e {\n  e.preventDefault();\n  e.returnValue = '';\n};\n```\n**Result:** Dialog did not appear\n\n### Attempt 2: Non-empty returnValue + return statement\n```typescript\nconst handleBeforeUnload = (e: BeforeUnloadEvent) =\u003e {\n  e.preventDefault();\n  e.returnValue = 'You have unsaved changes. Are you sure you want to leave?';\n  return e.returnValue;\n};\n```\n**Result:** Dialog still did not appear in Chrome\n\n## Current Implementation\nFile: `frontend/src/hooks/useNavigationGuard.ts` (lines 35-43)\n\nThe hook is called with `enabled: !!parsedPDF` in StudyPage.tsx, so it should be active when a PDF is loaded.\n\n## Possible Causes\n- Chrome may require specific user interaction before showing beforeunload dialog\n- Chrome throttles beforeunload dialogs as anti-abuse measure\n- Timing issues with React's useEffect cleanup/registration\n- Chrome DevTools may suppress the dialog when open\n- The event listener may not be registered at the right time\n\n## Investigation Needed\n- Test in Chrome with DevTools closed\n- Add console.log to verify handler is being called\n- Test in other browsers (Safari, Firefox) for comparison\n- Check if user interaction requirement is being met\n\n## Files\n- frontend/src/hooks/useNavigationGuard.ts\n- frontend/src/pages/StudyPage.tsx (line 106-109)\n\n## Related Commit\n4cef17a - fix(navigation): trigger browser warning on page refresh","status":"closed","priority":2,"issue_type":"task","owner":"choy.desmond@gmail.com","created_at":"2026-01-24T13:50:36.548584+08:00","created_by":"Desmond","updated_at":"2026-01-24T14:01:21.560655+08:00","closed_at":"2026-01-24T14:01:21.560655+08:00","close_reason":"Fixed by changing guard condition to check pdfFileUrl in addition to parsedPDF"}
